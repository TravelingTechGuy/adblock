<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Ad-blocker presentation</title>
    <meta name="description" content="Ad-blockers - what do they do to your site?">
    <meta name="author" content="Guy Vider">
    <meta name="keywords" content="Ad-blocker,adblock,html5,javascript,annoying,ads">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">
    <link rel="stylesheet" href="css/main.css">
    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
        document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <!-- home slide -->
            <section>
                <h1>Your Ad-blocker Broke My Site!</h1>
                <p><br></p>
                <p>Guy Vider</p>
                <p>
                    <a href="http://www.travelingtechguy.com">Traveling Tech Guy</a>
                </p>
                <br /><br />
                <p class="mediumText">
                    This presentation uses the <a href="https://github.com/hakimel/reveal.js">Reveal.js</a> framework by Hakim<br />
                    Special thanks to Steve Sauders' <a href="http://stevesouders.com/docs/paypal-spof-20121115.pptx">SPOF presentation</a> (PPT file)
                </p>
                <br /><br />
                <p class="mediumText fragment">
                    Use the &lt;space&gt; bar, arrow keys, or the navigator on the bottom right, to advance through presentation. Press &lt;esc&gt; to see a presentation map.
                </p>
            </section>
            <!-- end home slide -->

            <!-- about -->
            <section>
                <section>
                    <h2>About Me</h2>
                    <div class="pullLeft">
                        <ol>
                            <li>CTO of <a href="http://www.ex-pos.com" target="_blank">ExPOS Restaurant Analytics</a></li>
                            <li>Owner of <a href="http://www.TravelingTechGuy.com" target="_blank">Traveling Tech Guy</a> consulting</li>
                            <li>Web (PHP/Node.js/Asp.Net) and mobile (iOS, Android) developement experience</li>
                            <li>Blogs: <a href="http://blog.travelingtechguy.com/" target="_blank">blog.travelingtechguy.com</a> and <a href="http://code.travelingtechguy.com/" target="_blank">code.travelingtechguy.com</a></li>
                            <li>Github: <a href="https://github.com/TravelingTechGuy" target="_blank">https://github.com/TravelingTechGuy</a></li>
                        </ol>
                    </div>
                </section>
                <section>
                    <h2>About the Presentation</h2>
                    <h4 class="pullLeft">In this presentation we'll discuss:</h4>
                    <div class="pullLeft">
                        <ol>
                            <li class="fragment">What's are ad-blockers?</li>
                            <li class="fragment">Why do people use them?</li>
                            <li class="fragment">How do they impact your code? <strong>(NOT your revenue)</strong></li>
                            <li class="fragment">How to handle ad-blockers in your JavaScript code</li>
                            <li class="fragment">How to properly test that your code is ad-blocker proof</li>
                            <li class="fragment">Samples of web sites that handle and mishandle ad-blockers</li>
                        </ol>
                    </div>
                </section>
            </section>
            <!-- end about -->

            <!-- ad-blocker introduction -->
            <section>
                <section>
                    <h2>What's an Ad-blocker?</h2>
                    <div class="pullLeft fragment">
                        <ol>
                            <li>
                                A browser add-on/plugin/extension (pick your favorite browser's lingo) that maintains a blacklist of sites serving ads, cookies, beacons etc., and blocks content from those addresses
                                <br>
                                <br>
                            </li>
                            <li>
                                The user can manually add more site addresses, thus basically deciding what content appears on his page
                                <br>
                                <br>
                            </li>
                            <li>
                                Newer versions also block beacons and widgets from known social sites like Facebook, Twitter, LinkedIn etc.
                                <br>
                                <br>
                            </li>
                        </ol>
                    </div>
                </section>
                <section>
                    <h2>Why Use an Ad-blocker?</h2>
                    <div class="pullLeft">
                        <ol>
                            <li class="fragment">
                                Maintains your privacy - blocks beacons and analytics; prevents cross-site data sharing
                                <br>
                                <br>
                            </li>
                            <li class="fragment">
                                Blocks spam - unwanted/inappropriate/nagging ads
                                <br>
                                <br>
                            </li>
                            <li class="fragment">
                                Removes annoying ads - have you ever had a flash ad jumping in a loop in the middle of your screen?
                                <br>
                                <br>
                            </li class="fragment">
                            <li class="fragment">
                                Improves page load time significantly
                                <br>
                                <br>
                            </li>
                            <li class="fragment">
                                Conserves bandwidth
                            </li>
                        </ol>
                    </div>
                </section>
                <section>
                    <h2>Common Ad-blockers</h2>
                    <div class="pullLeft">
                        <ul>
                            <li>
                                <a href="https://adblockplus.org/en/">AdBlock+</a>
                                - the mother of them all. Started on Firefox, nowavailable for Chrome and mobile. Maintains updated black lists
                                <br>
                                <br>
                            </li>
                            <li>
                                <a href="https://www.ghostery.com/">Ghostery</a>
                                - one of the best blockers out there. Can many kinds of beacons and HTML elements. Shows current information on what's blocked and why
                                <br>
                                <br>
                            </li>
                            <li>
                                <a href="https://disconnect.me/">Disconnect</a>
                                - developed by an ex-Googler to block Facebook, but now blocks several other beacons and ad networks
                                <br>
                                <br>
                            </li>
                            <li>
                                <a href="https://tools.google.com/dlpage/gaoptout">GA Opt-Out</a>
                                - an extension offered by Google itself. It prevents any analytics going back to their server from your browser
                            </li>
                        </ul>
                    </div>
                </section>
                <section>
                    <h2>Ghostery Sample</h2>
                    <div>
                        <img src="img/Ghostery1.png">
                        <img src="img/Ghostery2.png">
                        <br>
                    </div>
                </section>
            </section>
            <!-- end ad-blocker introduction -->

            <!-- ad-blocker impact -->
            <section>
                <section>
                    <h2>Why Should I Care?</h2>
                    <div class="pullLeft">
                        You may be thinking: "my web app does not use any ads, or metrics - why should I care?". You should if you rely on one of the following:
                    </div>
                    <br />
                    <div class="pullLeft" class="fragment">
                        <ol>
                            <li>
                                <strong>Google maps or widgets</strong> - these can either be blocked by a plugin, or by the network provider (China?). Ever accessed a feedback form that misbehaved and had a big empty square in the middle? It might have been a map
                                <br /><br />
                            </li>
                            <li>
                                <strong>LinkedIn widgets</strong> - some ad-blockers treat LinkedIn as a tracker, so if you rely on LinkedIn Login, or Share widget - tough cookies
                                <br /><br />
                            </li>
                            <li>
                                <strong>Advertising Beacons</strong> - calling the beacon's API, when the beacon object is blocked, would kill any JavaScript code that follows
                                <br /><br />
                            </li>
                            <li>
                                <strong>Twitter</strong> - their scripts can really block your site, slowing it down would be the best outcome, crashing it the worst
                            </li>
                        </ol>
                    </div>
                </section>
                <section>
                    <h2>Common Pitfalls</h2>
                    <div class="pullLeft">
                        <br></div>
                    <div class="pullLeft">
                        <ul>
                            <li>
                                <span style="letter-spacing: -0.02em;">
                                    If your JavaScript code is dependent on an external resource loading...
                                    <br>
                                    <br>
                                </span>
                            </li>
                            <li>
                                <span style="letter-spacing: -0.02em;">
                                    If your code breaks or is unusable when a resource is not available...
                                    <br>
                                </span>
                                <br>
                            </li>
                            <li>
                                <span style="letter-spacing: -0.02em;">
                                    If the design of your page hinges upon an external component appearing at a certain location...
                                </span>
                            </li>
                        </ul>
                        <div><br></div>
                        <div class="pullLeft">
                            <strong>&nbsp; &nbsp; ...then any user who uses an ad-blocker<br>&nbsp; &nbsp; might break&nbsp;your web page</strong><br>
                        </div>
                    </div>
                </section>
            </section>
            <!-- ad-blocker impact -->

            <!-- ad-block fails -->
            <section>
                <section>
                    <h3>Ad-block #Fails</h3>
                    <div class="pullLeft">
                        <br></div>
                    <div class="pullLeft">
                        Here are a couple of commercial sites that do not anticipate ad-blockers, and may actually lose customers as a result of that.
                    </div>
                </section>
                <section>
                    <h3>Screwed Up Site: USAir</h3>
                    <img src="img/USAir.png" style="line-height: 1.2em; letter-spacing: -0.02em;">
                    <div class="pullLeft">
                        The behavior of flight booking on the USAir site is significantly affected by ad-block.
                    </div>
                    <div class="pullLeft"><br></div>
                    <div class="pullLeft">
                        The list of JS errors is long, and explains why certain aspects of the form that depend on JS (such as the drop-down calendars) don't work well, or at all.
                    </div>
                </section>
                <section>
                    <h3>Screwed Up Site: Engadget</h3>
                    <img src="img/Engadget.png" style="line-height: 1.2em; letter-spacing: -0.02em;">
                    <div class="pullLeft">
                        Searching Engadget fails - even tech web sites are not immune :)
                    </div>
                </section>
                <section>
                    <h3>Screwed Up Site: LiveNation</h3>
                    <iframe width="640" height="360" src="https://www.youtube.com/embed/2WmbfK2M2wo?autoplay=0&autohide=1&modestbranding=1&rel=0&hd=1" frameborder="0" allowfullscreen></iframe>
                    <div class="pullLeft">
                        Select a venue seat, hit the checkout button, and... nothing.<br/>
                        <br/>
                        Open the JS console and admire the view: It seems to hit the same JS error in an infinite loop. 
                        <br/><br/>
                        Fun for hours. Loss of customers guaranteed.
                        <small><a href="http://www.youtube.com/embed/2WmbfK2M2wo" target="_blank">Link to video</a></small>
                    </div>
                </section>
                <section>
                    <h3>Screwed Up Site: T-Mobile</h3>
                    <img src="img/tmo.png" style="line-height: 1.2em; letter-spacing: -0.02em;">
                    <div class="pullLeft">
                        Try paying on the site, and get thrown back to the login page, again and again.
                    </div>
                </section>
                <section>
                    <h3>Screwed Up Site: Best Buy</h3>
                    <img src="img/BestBuy.png" style="line-height: 1.2em; letter-spacing: -0.02em;">
                    <div class="pullLeft">
                        Switch to item spec
                    </div>
                </section>
            </section>
            <!-- ad-block fails -->

            <!-- JavaScript code samples -->
            <section>
                <section>
                    <h2>JavaScript Patterns</h2>
                    <div class="pullLeft">If your code looks like this:</div>
                    <pre>
                        <code>
&lt;script src="/link/to/remote/script.js"&gt;&lt;/script&gt;

...

&lt;script&gt;
    var x = objectFromRemoteScript.property;
    objectFromRemoteScript.function();
&lt;/script&gt;
                        </code>
                    </pre>
                    <div class="pullLeft">Then you're potentially falling into the same trap:</div>
                    <div class="pullLeft">what if /link/to/remote is on the ad-blocker's blacklist?</div>
                    <div class="pullLeft">
                        <br></div>
                    <div class="pullLeft">
                        The object you refer to will evaluate to&nbsp;
                        <span style="font-size: 0.55em; line-height: 1.2em; letter-spacing: -0.02em; background-color: rgb(255, 51, 0);">undefined</span>
                        , so calling a method or accessing a property will yield an error.
                    </div>

                </section>
                <section>
                    <h1>Hands-on Demo</h1>
                    <a href="demo/google.html" target="_blank">Google API</a>&nbsp;|&nbsp;
                    <a href="demo/twitter.html" target="_blank">Twitter & LinkedIn</a>&nbsp;|&nbsp;
                    <a href="demo/comscore.html" target="_blank">comScore API</a>&nbsp;|&nbsp;
                    <a href="demo/google.html" target="_blank">comScore API fixed</a>
                    <div><br><br><br></div>
                    <div style="font-size: medium">
                        To test, you'll need to browse to the pages, rather than open them.<br>
                        Just run <code style="background: #3f3f3f">node app.js</code> in the presentation's root,<br>
                        and browse to http://localhost:1337/demo/&lt;page name&gt;
                    </div>
                </section>
                <section>
                    <h2>Just Check for Existence</h2>
                    <pre>
                        <code>
&lt;script src="/link/to/remote/script.js"&gt;&lt;/script&gt;

...

&lt;script&gt;
if(typeof objectFromRemoteScript == 'undefined') {
    
    //prepare an alternative plan:
    //1. work around the missing component
    //2. use an alternative
    //3. if the object is absolutely mandatory, alert the user

}
else {

    //do the stuff you intended to originally

}
&lt;/script&gt;
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>More Existence Checking Patterns</h2>
                    <div class="pullLeft">
                        <ol>
                            <li>
                                Check whether the object is accessible globally:
                                <br>
                                <pre><code>if(typeof window.expectedObject == 'undefined') {...</code></pre>
                                <br>
                            </li>
                            <li>
                                This will return <span style="background-color: rgb(255, 51, 0);">true</span>
                                if the object exists, <span style="background-color: rgb(255, 51, 0);">false</span>
                                otherwise:
                                <br>
                                <pre><code>if(!!window.expectedObject) {...</code></pre>
                                <br>
                            </li>
                            <li>
                                Check if the object exists in the global namespace:
                                <br>
                                <pre><code>if("myObjectName" in global) {...</code></pre>
                            </li>
                        </ol>
                    </div>
                </section>
            </section>
            <!-- end JavaScript code samples -->
            
            <!-- testing -->
            <section>
                <section>
                    <h3>Client Side Unit Testing</h3>
                    <div class="pullLeft">
                        Use client side unit tests to find out how your code fairs when ad-blockers are present.<br><br>
                        In the following demo, I'm utilizing <a href="http://qunitjs.com/" target="_blank">QUint</a> to check for the existence of a global variable that's supposed to exist for the code to run
                    </div>
                    <br>
                    <a href="demo/comscore-qunit.html" target="_blank">Demo</a>
                </section>
                <section>
                    <h3>Automatic Testing</h3>
                    <div class="pullLeft">
                        If you're utilizing a headless broser (such as Selenium, PhantomJS) for your automatic testing, there's no good/easy way to add ad-blockers to the mix.<br><br>
                        Your best bet is to test on a machine with firewall (or iptables) rules that block the urls of all external resources.<br><br>
                        Needless to say, load testing should be carried out on another machine, as the full load of the pages includes external resources.
                    </div>
                </section>
                <section>
                    <h3>Test for Ad-blocker's Existence</h3>
                    <div class="pullLeft">
                        Because Ad-blockers operate on the browser/client side, there's no easy way to detect their presence from the server, but the following 3-step approach should serve you well:
                        <br><br>
                        <ol>
                            <li>In your first page, add a &lt;script&gt; element. In it, set a global variable to a value</li>
                            <li>Load a JavaScript file, with a name that is sure to be blocked by an ad-blocker (i.e. 'ads.js').<br>
                                This file will contain a single line, that changes the value of the global variable
                            </li>
                            <li>Check the value of the variable - if it didn't change, an ad-blocker is in place.<br>
                                You can react on the page itself, redirect the user, or send the server notice via Ajax
                            </li>
                        </ol>
                    </div>
                    <br>
                    <a href="demo/existence.html" target="_blank">Demo</a>
                </section>
            </section>
            <!-- end testing -->

            <!-- handling ad-blocking gracefully -->
            <section>
                <section>
                    <h2>Handling Ad-blockers Gracefully</h2>
                    <div class="pullLeft">
                        <br></div>
                    <div class="pullLeft">
                        Here are a couple of commercial sites that are very aware of the existence of ad-blockers, and will inform you (or punish you) for using them.
                    </div>
                </section>
                <section>
                    <h2>OKCupid</h2>
                    <div class="pullLeft">
                        OkCupid will inform you that you're harming their revenue stream, and ask for donation:
                        <img src="img/OKCupid.png" style="line-height: 1.2em; text-align: center; letter-spacing: -0.02em; float:right;"></div>
                </section>
                <section>
                    <h2>Hulu</h2>
                    <div class="pullLeft">
                        Hulu will punish you with a 30-60 seconds delay before allowing you to watch a video, if you're blocking ads:
                    </div>
                    <div class="pullLeft">
                        <img src="img/Hulu.png">
                        <br></div>
                </section>
                <section>
                    <h2>AllThingsD</h2>
                    <div class="pullLeft">
                        Will inform you of their use of trackers, and even encourage you to install an ad-blocker (Ghostery a favorite):
                    </div>
                    <div class="pullLeft">
                        <img src="img/AllThingsD.png">
                        <br></div>
                    <div class="pullLeft">
                        Fun fact: This message itself uses a cookie; so it would only appear to you once - unless you blocked it originally, that is. :)
                    </div>
                </section>
            </section>
            <!-- end handling ad-blocking gracefully -->
            
            <!-- summary -->
            <section>
                <h2>Questions?</h2>
                <div>
                    Feel free to contact me at:
                    <ul>
                        <li><a href="http://www.travelingtechguy.com">www.TravelingTechGuy.com</a></li>
                        <li><a href="https://twitter.com/traveltechguy">@TravelTechGuy</a> on Twitter</li>
                        <li>Fork this presentation on <a href="https://github.com/TravelingTechGuy/adblock">https://github.com/TravelingTechGuy/adblock</a></li>
                        <li>View this presentation at <a href="http://tinyurl.com/adblockPres">tinyurl.com/adblockPres</a> or scan the QR:</li>
                    </ul>
                </div>
                <div>
                    <img src="img/adblockQR.png">
                </div>
            </section>
            <!-- end summary -->
        </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
                ]
            });

        </script>

</body>
</html>